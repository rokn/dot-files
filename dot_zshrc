setopt autocd

export EDITOR="vim"

# Default paths
BREW_PREFIX=$(brew --prefix)
export PATH="$HOME/.local/bin/:$PATH"
export PATH="$BREW_PREFIX/bin:$PATH"

# asdf binaries
export PATH="$HOME/.asdf/shims:$PATH"

# Case insensitive
zstyle ':completion:*' matcher-list '' 'm:{a-zA-Z}={A-Za-z}' 'r:|=*' 'l:|=* r:|=*'
autoload -Uz compinit && compinit

setopt auto_cd

if ! which starship >/dev/null; then
	curl -fsSL https://starship.rs/install.sh | sh
fi

if which lsd > /dev/null; then
	alias ls="lsd"
fi
eval "$(starship init zsh)"

source "$HOME/.config/zsh/functions.zsh"

# Source additional configuration files
local config_files=(
    "$HOME/.local/bin/env"
    "$HOME/.config/zsh/aliases.zsh"
    "$BREW_PREFIX/etc/profile.d/autojump.sh"
)

for config_file in $config_files; do
    [ -f "$config_file" ] && source "$config_file"
done

# Add completions
# Custom completions directory
fpath=(~/.zsh/completions $fpath)

# Initialize completion system
autoload -Uz compinit
compinit

eval "$(uv generate-shell-completion zsh)"
eval "$(direnv hook zsh)"
eval "$(task --completion zsh)"

# Key bindings
bindkey -v

bindkey "^[[1;3C" forward-word
bindkey "^[[1;3D" backward-word

autoload -Uz edit-command-line

zle -N edit-command-line
bindkey '^X^E' edit-command-line

zle -N clear_and_context_widget
bindkey '^L' clear_and_context_widget

# FZF reverse search
source <(fzf --zsh)

# Zinit
ZINIT_HOME="${XDG_DATA_HOME:-${HOME}/.local/share}/zinit/zinit.git"
[ ! -d $ZINIT_HOME ] && mkdir -p "$(dirname $ZINIT_HOME)"
[ ! -d $ZINIT_HOME/.git ] && git clone https://github.com/zdharma-continuum/zinit.git "$ZINIT_HOME"
source "${ZINIT_HOME}/zinit.zsh"

# Do machine specific stuff last so we can override the aliases and functions
source "$HOME/.config/zsh/machine_specific"

# Print the current directory when changing directories (like ls -la)
chpwd() {
    clear_and_context
}

ls
